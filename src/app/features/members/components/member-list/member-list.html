<div class="page-header">
    <h1>Members</h1>
    <a mat-raised-button color="primary" routerLink="/members/add">
        <mat-icon>add</mat-icon> Add Member
    </a>
</div>

<div class="mat-elevation-z2 table-container" [@fadeIn]>
    <!-- Loading removed or handled by dataSource logic manually if needed, 
         but MatTableDataSource handles empty arrays gracefully. 
         Spinner can be conditional on an 'isLoading' flag if we added one. 
         For simplicity, keeping it simple. -->

    <table mat-table [dataSource]="dataSource" class="full-width-table" [@staggerList]>

        <!-- Name Column -->
        <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let member">
                <div class="member-name">{{ member.name }}</div>
                <div class="member-email">{{ member.contactNumber }}</div>
            </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="membershipStatus">
            <th mat-header-cell *matHeaderCellDef> Status </th>
            <td mat-cell *matCellDef="let member">
                <mat-chip-set>
                    <mat-chip [color]="member.membershipStatus === 'Active' ? 'accent' : 'warn'" selected>
                        {{ member.membershipStatus | titlecase }}
                    </mat-chip>
                </mat-chip-set>
            </td>
        </ng-container>

        <!-- Expiration Column -->
        <ng-container matColumnDef="expiration">
            <th mat-header-cell *matHeaderCellDef> Expiration </th>
            <td mat-cell *matCellDef="let member"> 
                 <ng-container *ngIf="member.expiration?.seconds; else dateObj">
                    {{ member.expiration.seconds * 1000 | date:'mediumDate' }}
                 </ng-container>
                 <ng-template #dateObj>
                    {{ member.expiration | date:'mediumDate' }}
                 </ng-template>
            </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> Actions </th>
            <td mat-cell *matCellDef="let member">
                <a mat-icon-button [routerLink]="['/members', member.id, 'progress']" matTooltip="View Progress"
                    color="primary">
                    <mat-icon>insights</mat-icon>
                </a>
                <a mat-icon-button [routerLink]="['/members/edit', member.id]" matTooltip="Edit Member">
                    <mat-icon>edit</mat-icon>
                </a>
                <button mat-icon-button (click)="toggleStatus(member)"
                    [matTooltip]="member.membershipStatus === 'Active' ? 'Deactivate' : 'Activate'" color="warn">
                    <mat-icon>{{ member.membershipStatus === 'Active' ? 'block' : 'check_circle' }}</mat-icon>
                </button>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator [pageSizeOptions]="[10, 20, 50]"
                 showFirstLastButtons
                 aria-label="Select page of members">
    </mat-paginator>
</div>